# ===============================================================================================
#  SCHOOL MANAGEMENT SYSTEM - COMPREHENSIVE ARCHITECTURE & SYSTEM DOCUMENTATION
#  Version: 5.0.0 (Production Release)
#  Last Updated: Dec 16, 2025
#  Architecture: Multi-Tenant, Role-Based, Cloud-Native SaaS Platform
# ===============================================================================================

## ğŸ”¹ **1. EXECUTIVE SUMMARY & SYSTEM OVERVIEW**

### **1.1. System Vision**
The School Management System is an enterprise-grade, multi-tenant SaaS platform designed to revolutionize educational administration through intelligent automation, comprehensive data management, and seamless stakeholder collaboration.

### **1.2. Core Architecture Principles**
- **Security-First**: Every design decision prioritizes data protection and privacy
- **Scalability**: Built for growth from single institutions to multi-national chains
- **Multi-Tenancy**: Complete data isolation between educational institutions
- **Role-Based Access**: Granular permissions with least-privilege enforcement
- **API-Driven**: All operations accessible through secure, documented APIs
- **Audit-Ready**: Complete audit trail for compliance and security monitoring

### **1.3. Technology Stack**
```
Frontend: React 18 + TypeScript + Tailwind CSS
â”œâ”€â”€ State Management: React Context + Custom Hooks
â”œâ”€â”€ Routing: React Router v6 with lazy loading
â”œâ”€â”€ Forms: Custom validation with Zod schemas
â”œâ”€â”€ UI Components: Custom design system with Radix primitives
â”œâ”€â”€ Charts: Recharts for analytics visualization
â””â”€â”€ Build: Vite with Tree-shaking and Code splitting

Backend: Supabase (PostgreSQL + Auth + Storage + Edge Functions)
â”œâ”€â”€ Database: PostgreSQL 15+ with custom extensions
â”œâ”€â”€ Authentication: Supabase Auth with JWT tokens
â”œâ”€â”€ Authorization: Row Level Security (RLS) at database level
â”œâ”€â”€ File Storage: Supabase Storage with CDN
â”œâ”€â”€ Real-time: WebSocket subscriptions for live updates
â””â”€â”€ API: PostgREST with custom RPC functions

Infrastructure: Vercel + Supabase Cloud
â”œâ”€â”€ Hosting: Vercel with global edge deployment
â”œâ”€â”€ Database: Supabase managed PostgreSQL
â”œâ”€â”€ CDN: Vercel Edge Network for static assets
â”œâ”€â”€ Monitoring: Supabase Analytics + Custom dashboards
â””â”€â”€ CI/CD: GitHub Actions with automated deployments
```

---

## ğŸ”¹ **2. DETAILED SYSTEM ARCHITECTURE**

### **2.1. High-Level Architecture Diagram**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLIENT LAYER (Frontend)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  React SPA (Browser/Mobile/PWA)                                 â”‚
â”‚  â”œâ”€â”€ Authentication State Management                            â”‚
â”‚  â”œâ”€â”€ Role-Based UI Rendering                                    â”‚
â”‚  â”œâ”€â”€ Real-time Data Subscriptions                               â”‚
â”‚  â””â”€â”€ Offline-First Progressive Enhancement                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API GATEWAY LAYER                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Supabase PostgREST + Edge Functions                            â”‚
â”‚  â”œâ”€â”€ Authentication Middleware (JWT Validation)                 â”‚
â”‚  â”œâ”€â”€ Rate Limiting & Abuse Prevention                           â”‚
â”‚  â”œâ”€â”€ Request Logging & Audit Trail                              â”‚
â”‚  â””â”€â”€ Data Validation & Sanitization                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 BUSINESS LOGIC LAYER                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PostgreSQL Functions (RPC)                                     â”‚
â”‚  â”œâ”€â”€ Authentication & Authorization Logic                       â”‚
â”‚  â”œâ”€â”€ Multi-Tenant Data Isolation                                â”‚
â”‚  â”œâ”€â”€ Business Rule Enforcement                                  â”‚
â”‚  â”œâ”€â”€ Data Validation & Constraints                              â”‚
â”‚  â”œâ”€â”€ Audit Logging & Compliance                                 â”‚
â”‚  â””â”€â”€ Integration with External Services                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DATA PERSISTENCE LAYER                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PostgreSQL Database                                            â”‚
â”‚  â”œâ”€â”€ Row Level Security (RLS) Policies                          â”‚
â”‚  â”œâ”€â”€ Multi-Tenant Data Partitioning                             â”‚
â”‚  â”œâ”€â”€ Audit Tables & Change Tracking                             â”‚
â”‚  â”œâ”€â”€ Performance Indexes & Optimization                         â”‚
â”‚  â””â”€â”€ Backup & Disaster Recovery                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 INTEGRATION LAYER                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  External Services & APIs                                       â”‚
â”‚  â”œâ”€â”€ Google Gemini AI Integration                               â”‚
â”‚  â”œâ”€â”€ Email Service (SendGrid/Resend)                            â”‚
â”‚  â”œâ”€â”€ Payment Gateway (Stripe/PayPal)                           â”‚
â”‚  â”œâ”€â”€ SMS Service (Twilio)                                       â”‚
â”‚  â””â”€â”€ File Storage (Supabase Storage + CDN)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **2.2. Data Flow Architecture**

#### **2.2.1. Authentication Flow**
```
User Login Request
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Supabase Auth â”‚â”€â”€â”€â–¶â”‚  JWT Generation â”‚â”€â”€â”€â–¶â”‚  Profile Lookup â”‚
â”‚   Validation    â”‚    â”‚   + RLS Token   â”‚    â”‚   + Role Cache  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                              â”‚
        â–¼                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Client-Side State Management                      â”‚
â”‚    â”œâ”€â”€ User Profile & Role Context                         â”‚
â”‚    â”œâ”€â”€ Permission Matrix Caching                           â”‚
â”‚    â””â”€â”€ Real-time Subscriptions Setup                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **2.2.2. Multi-Tenant Data Isolation Flow**
```
User Request with JWT
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RLS Policy Evaluation                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Tenant ID   â”‚  â”‚ User Role   â”‚  â”‚ Permissions â”‚         â”‚
â”‚  â”‚ Matching    â”‚  â”‚ Validation  â”‚  â”‚ Matrix      â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Data Access Control                             â”‚
â”‚  â”œâ”€â”€ Branch-based filtering (get_my_branch_ids())          â”‚
â”‚  â”œâ”€â”€ Role-based access (teacher_profiles, etc.)            â”‚
â”‚  â””â”€â”€ Admin overrides (super_admin bypass)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”¹ **3. ROLE-BASED ACCESS CONTROL (RBAC) SYSTEM**

### **3.1. Role Hierarchy & Permissions**

#### **3.1.1. Super Admin (System-Wide)**
```
Permissions: SYSTEM_ADMIN, ALL_ACCESS, OVERRIDE_RLS
Access Scope: All tenants, all data, system configuration
Functions: System maintenance, audit access, cross-tenant analytics
```

#### **3.1.2. School Administration (Institution-Level)**
```
Permissions: SCHOOL_ADMIN, MULTI_BRANCH_ACCESS, USER_MANAGEMENT
Access Scope: All branches within their institution
Functions: Multi-branch oversight, financial reports, system settings
```

#### **3.1.3. Branch Admin (Branch-Level)**
```
Permissions: BRANCH_ADMIN, SINGLE_BRANCH_ACCESS
Access Scope: Single assigned branch only
Functions: Branch operations, local staff management, branch reporting
```

#### **3.1.4. Principal (Academic Leadership)**
```
Permissions: ACADEMIC_ADMIN, STAFF_SUPERVISION
Access Scope: All academic operations within assigned scope
Functions: Academic oversight, teacher evaluation, curriculum management
```

#### **3.1.5. HR Manager (Personnel Management)**
```
Permissions: HR_MANAGEMENT, EMPLOYEE_RECORDS
Access Scope: Staff records, hiring, payroll coordination
Functions: Employee lifecycle management, compliance reporting
```

#### **3.1.6. Academic Coordinator (Curriculum Oversight)**
```
Permissions: ACADEMIC_COORDINATION, CURRICULUM_MANAGEMENT
Access Scope: Academic programs, course scheduling, assessment
Functions: Curriculum design, teacher coordination, academic reporting
```

#### **3.1.7. Accountant (Financial Management)**
```
Permissions: FINANCE_MANAGEMENT, PAYROLL_ACCESS
Access Scope: Financial operations, fee collection, expense tracking
Functions: Financial reporting, payment processing, budget management
```

#### **3.1.8. Teacher (Instructional Delivery)**
```
Permissions: CLASS_MANAGEMENT, GRADE_ENTRY, PARENT_COMMUNICATION
Access Scope: Assigned classes, enrolled students, lesson planning
Functions: Classroom management, grading, parent communication
```

#### **3.1.9. Student (Learning Management)**
```
Permissions: PERSONAL_DATA, ASSIGNMENT_ACCESS
Access Scope: Own academic records, assignments, communication
Functions: Assignment submission, grade viewing, profile management
```

#### **3.1.10. Parent/Guardian (Student Oversight)**
```
Permissions: CHILD_DATA_ACCESS, COMMUNICATION
Access Scope: Enrolled children's records, communications
Functions: Child progress monitoring, fee payment, document submission
```

#### **3.1.11. Transport Staff (Operational)**
```
Permissions: TRANSPORT_MANAGEMENT, ROUTE_OVERSIGHT
Access Scope: Assigned routes, student transportation tracking
Functions: Bus attendance, route management, parent notifications
```

#### **3.1.12. E-commerce Operator (Marketplace)**
```
Permissions: PRODUCT_MANAGEMENT, ORDER_PROCESSING
Access Scope: School marketplace operations, product catalogs
Functions: Product listings, order fulfillment, payment processing
```

---

## ğŸ”¹ **4. MULTI-TENANCY & DATA ISOLATION**

### **4.1. Tenant Isolation Strategy**

#### **4.1.1. School-Level Isolation**
```
Each Educational Institution = Independent Tenant
â”œâ”€â”€ Complete data separation at database level
â”œâ”€â”€ Independent authentication and user management
â”œâ”€â”€ Separate financial and reporting data
â”œâ”€â”€ Isolated communication channels
â””â”€â”€ Independent system configuration
```

#### **4.1.2. Branch-Level Segmentation**
```
Within Each School = Multiple Branches
â”œâ”€â”€ Branch-specific user groups
â”œâ”€â”€ Branch-scoped data access (RLS)
â”œâ”€â”€ Independent operational data
â”œâ”€â”€ Separate reporting and analytics
â””â”€â”€ Cross-branch administrative controls (Head Office only)
```

---

## ğŸ”¹ **5. SECURITY ARCHITECTURE**

### **5.1. Defense-in-Depth Security Model**

#### **5.1.1. Authentication Layer**
```
Multi-Factor Authentication (MFA)
â”œâ”€â”€ Password-based authentication (Supabase Auth)
â”œâ”€â”€ Email verification for new accounts
â”œâ”€â”€ Optional SMS/Email OTP for sensitive operations
â”œâ”€â”€ Session management with JWT tokens
â””â”€â”€ Automatic session timeout and refresh
```

#### **5.1.2. Authorization Layer**
```
Role-Based Access Control (RBAC)
â”œâ”€â”€ Database-level RLS policies
â”œâ”€â”€ Application-level permission checks
â”œâ”€â”€ API-level route protection
â””â”€â”€ Client-side UI permission rendering
```

#### **5.1.3. Data Protection Layer**
```
Encryption & Data Security
â”œâ”€â”€ Encryption at rest (database level)
â”œâ”€â”€ Encryption in transit (HTTPS/WSS)
â”œâ”€â”€ Sensitive field encryption (PII, financial data)
â”œâ”€â”€ Secure file storage with access controls
â””â”€â”€ Data anonymization for analytics
```

### **5.2. Row Level Security (RLS) Implementation**

#### **5.2.1. RLS Policy Categories**

**1. Ownership-Based Policies**
```sql
-- Users can only access their own data
CREATE POLICY "Users can manage their own profile" 
ON public.profiles
FOR ALL USING (id = auth.uid());
```

**2. Role-Based Policies**
```sql
-- Teachers can view students in their classes
CREATE POLICY "Teachers can view class students"
ON public.student_profiles
FOR SELECT USING (
  assigned_class_id IN (
    SELECT id FROM school_classes 
    WHERE class_teacher_id = auth.uid()
  )
);
```

**3. Tenant-Based Policies**
```sql
-- Branch-scoped data access
CREATE POLICY "Branch-scoped data access"
ON public.school_classes
FOR ALL USING (
  branch_id IN (SELECT get_my_branch_ids())
);
```

**4. Administrative Override Policies**
```sql
-- Super admin bypass
CREATE POLICY "Super admin override"
ON public.profiles
FOR ALL USING (
  EXISTS (
    SELECT 1 FROM profiles 
    WHERE id = auth.uid() AND is_super_admin = true
  )
);
```

### **5.3. Audit & Compliance**

#### **5.3.1. Comprehensive Audit Trail**
```sql
-- Audit logging table
CREATE TABLE public.audit_logs (
    id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id uuid REFERENCES profiles(id),
    action text NOT NULL,
    resource_type text NOT NULL,
    resource_id text,
    old_values jsonb,
    new_values jsonb,
    ip_address inet,
    user_agent text,
    created_at timestamptz DEFAULT now()
);
```

#### **5.3.2. Compliance Monitoring**
- **GDPR Compliance**: Data portability, right to be forgotten
- **FERPA Compliance**: Student record privacy protection
- **SOX Compliance**: Financial data integrity and audit trail
- **ISO 27001**: Information security management

---

## ğŸ”¹ **6. SCALABILITY & PERFORMANCE ARCHITECTURE**

### **6.1. Database Optimization Strategy**

#### **6.1.1. Indexing Strategy**
```sql
-- Performance-critical indexes
CREATE INDEX CONCURRENTLY idx_profiles_role ON profiles(role);
CREATE INDEX CONCURRENTLY idx_student_profiles_class ON student_profiles(assigned_class_id);
CREATE INDEX CONCURRENTLY idx_attendance_date_student ON attendance(attendance_date, student_id);
CREATE INDEX CONCURRENTLY idx_teacher_profiles_branch ON teacher_profiles(branch_id);
CREATE INDEX CONCURRENTLY idx_admissions_status ON admissions(status);
```

#### **6.1.2. Query Optimization**
- **Materialized Views**: For complex reporting queries
- **Partitioning**: Time-based partitioning for audit logs
- **Connection Pooling**: PgBouncer for connection management
- **Read Replicas**: For reporting and analytics workloads

---

## ğŸ”¹ **7. AI INTEGRATION ARCHITECTURE**

### **7.1. Google Gemini AI Integration**

#### **7.1.1. AI Service Architecture**
```
AI Integration Layer
â”œâ”€â”€ Gemini API Integration: Text generation and analysis
â”œâ”€â”€ Prompt Engineering: Optimized prompts for educational context
â”œâ”€â”€ Response Processing: AI output validation and formatting
â”œâ”€â”€ Error Handling: Graceful degradation and retry logic
â””â”€â”€ Usage Monitoring: AI request tracking and cost optimization
```

#### **7.1.2. AI Use Cases Implementation**

**1. Curriculum Generation**
- Automated syllabus creation based on learning objectives
- Weekly topic planning with activity suggestions
- Assessment question generation
- Resource recommendation

**2. Intelligent Scheduling**
- Conflict detection for timetables
- Optimal teacher-classroom assignments
- Resource utilization optimization
- Exception handling for special events

**3. Academic Analytics**
- Student performance predictions
- Learning pattern analysis
- Intervention recommendations
- Progress tracking insights

#### **7.1.3. AI Safety & Governance**
- **Input Validation**: Sanitization of all AI inputs
- **Output Filtering**: Review of AI-generated content
- **Human Oversight**: Critical decisions require human review
- **Bias Detection**: Regular auditing of AI responses
- **Privacy Compliance**: Data anonymization before AI processing

---

## ğŸ”¹ **8. ERROR HANDLING & RESILIENCE**

### **8.1. Comprehensive Error Strategy**

#### **8.1.1. Error Classification**
- **CRITICAL**: System down, data loss
- **HIGH**: Major feature broken
- **MEDIUM**: Feature degraded
- **LOW**: Minor inconvenience
- **INFO**: Informational

#### **8.1.2. Resilience Patterns**
- **Circuit Breaker Pattern**: Prevent cascade failures
- **Retry Strategy**: Exponential backoff for transient errors
- **Graceful Degradation**: Feature flags and fallback mechanisms
- **Offline Mode**: Cache critical data for offline access

---

## ğŸ”¹ **9. MONITORING & OBSERVABILITY**

### **9.1. Comprehensive Monitoring Strategy**

#### **9.1.1. Key Performance Indicators**
- **Database Response Time**: < 100ms for 95th percentile
- **API Response Time**: < 200ms for authenticated requests
- **Page Load Time**: < 3 seconds for initial load
- **Real-time Latency**: < 500ms for live updates
- **Error Rate**: < 0.1% for critical operations

#### **9.1.2. Monitoring Stack**
```
Observability Platform
â”œâ”€â”€ Database Monitoring: Supabase Analytics + Custom queries
â”œâ”€â”€ Application Monitoring: Vercel Analytics + Sentry
â”œâ”€â”€ Real-time Monitoring: WebSocket connection health
â”œâ”€â”€ Performance Tracking: Core Web Vitals monitoring
â””â”€â”€ Alert System: Automated alerts for SLA breaches
```

---

## ğŸ”¹ **10. DEPLOYMENT & OPERATIONS**

### **10.1. CI/CD Pipeline Architecture**

#### **10.1.1. Deployment Strategy**
```
Environment Strategy
â”œâ”€â”€ Development: Feature development and testing
â”œâ”€â”€ Staging: Production-like testing environment
â”œâ”€â”€ Production: Live system with real data
â”œâ”€â”€ Disaster Recovery: Backup environment for recovery
â””â”€â”€ Monitoring: Separate environment for observability
```

#### **10.1.2. Backup & Disaster Recovery**
```
Recovery Time Objectives (RTO)
â”œâ”€â”€ Critical Systems: 1 hour
â”œâ”€â”€ Non-critical Systems: 4 hours
â””â”€â”€ Analytics Systems: 24 hours

Recovery Point Objectives (RPO)
â”œâ”€â”€ Transactional Data: 15 minutes
â”œâ”€â”€ Configuration Data: 1 hour
â””â”€â”€ Historical Data: 24 hours
```

---

## ğŸ”¹ **11. COMPLIANCE & GOVERNANCE**

### **11.1. Regulatory Compliance**

#### **11.1.1. Educational Compliance**
- **FERPA**: Family Educational Rights and Privacy Act
- **COPPA**: Children's Online Privacy Protection Act
- **State Education Regulations**: Local compliance requirements
- **Accreditation Standards**: Educational institution requirements

#### **11.1.2. Data Protection Compliance**
- **GDPR**: General Data Protection Regulation (EU)
- **CCPA**: California Consumer Privacy Act
- **PIPEDA**: Personal Information Protection and Electronic Documents Act (Canada)
- **LGPD**: Lei Geral de ProteÃ§Ã£o de Dados (Brazil)
- **Privacy by Design**: Built-in privacy protections

---

## ğŸ”¹ **12. FUTURE ROADMAP & EVOLUTION**

### **12.1. Technology Evolution**

#### **12.1.1. Short-term Enhancements (6 months)**
- **Mobile Application**: Native iOS/Android apps
- **Advanced Analytics**: Machine learning insights
- **Integration Marketplace**: Third-party integrations
- **Offline Capabilities**: Progressive Web App features
- **Enhanced Security**: Biometric authentication

#### **12.1.2. Medium-term Expansion (12 months)**
-
